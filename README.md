# Система мониторинга веб-страниц

Система для мониторинга и управления клиентскими веб-страницами через WebSocket.

## Возможности

- Мониторинг веб-страниц в реальном времени
- Сбор данных о странице (URL, заголовок, текст, HTML)
- Управление клиентами через админ-панель
- Отправка сообщений клиентам с настраиваемой прозрачностью
- Настройка интервала обновления данных
- Автоматическое переподключение при обрыве связи
- Современный и удобный интерфейс в стиле HuggingFace
- Эмуляция jQuery для страниц, где он отсутствует
- Обработка ошибок загрузки ресурсов в превью

## Инструкция по деплою на Render.com

### Шаг 1: Загрузите код в GitHub

1. Создайте новый репозиторий на GitHub
2. Загрузите все файлы проекта в этот репозиторий

### Шаг 2: Создайте аккаунт на Render.com

1. Зарегистрируйтесь на [Render.com](https://render.com/)
2. Подтвердите email

### Шаг 3: Создайте новый Web Service

1. Войдите в Dashboard на Render.com
2. Нажмите "New" и выберите "Web Service"
3. Подключите ваш GitHub репозиторий
4. Выберите проект для деплоя

### Шаг 4: Настройте Web Service

1. Введите имя для вашего сервиса
2. Оставьте "Environment" как "Node"
3. Оставьте "Build Command" пустым или введите `npm install`
4. "Start Command" уже должна быть установлена как `node server.js` (из Procfile)
5. Выберите бесплатный план "Free"

### Шаг 5: Завершите настройку и разверните

1. Нажмите "Create Web Service"
2. Render автоматически начнет процесс деплоя
3. Дождитесь завершения деплоя и получите URL вашего сервиса

### Шаг 6: Получение доступа к администраторской панели

1. Откройте URL вашего сервиса в браузере
2. Добавьте `/admin.html` к URL для доступа к админ-панели

## Локальный запуск

1. Убедитесь, что у вас установлен Node.js
2. Клонируйте репозиторий
3. Установите зависимости: `npm install`
4. Запустите сервер: `npm start`
5. Откройте `http://localhost:3000/admin.html` для доступа к админ-панели

## Использование

### Клиентская часть

Для мониторинга страницы, добавьте букмарклет в браузер:

1. После деплоя на Render.com откройте ваш сайт:
```
https://ваш-сайт.onrender.com
```

2. Следуйте инструкциям на странице для установки букмарклета.

3. Букмарклет будет автоматически настроен на работу с вашим доменом. Код будет примерно таким:
```javascript
javascript:(function(){var s=document.createElement('script');s.src='https://ваш-сайт.onrender.com/client.js';document.body.appendChild(s);})()
```

### Админ-панель

1. Откройте админ-панель в браузере:
```
https://ваш-сайт.onrender.com/admin.html
```

2. В админ-панели вы можете:
- Просматривать список активных клиентов
- Видеть превью страниц
- Просматривать HTML-код
- Просматривать текстовое содержимое 
- Отправлять сообщения клиентам с настраиваемой прозрачностью
- Управлять состоянием клиентов (пауза/возобновление)
- Настраивать интервал обновления данных

## CORS и безопасность на Render.com

При работе с Render.com и другими хостинг-провайдерами следует учитывать:

1. **HTTPS-соединения**: Render.com автоматически обеспечивает HTTPS для вашего сайта. Букмарклет будет использовать WSS (защищенный WebSocket) вместо WS.

2. **Смешанный контент**: Если вы пытаетесь использовать букмарклет на HTTPS-сайте, то ваш сервер мониторинга также должен быть доступен через HTTPS. Render.com обеспечивает это по умолчанию.

3. **CORS-политики**: Некоторые сайты могут блокировать загрузку внешних скриптов. Букмарклет пытается обойти это ограничение, но не на всех сайтах это возможно.

## Структура проекта

- `server.js` - серверная часть
- `public/client.js` - клиентский скрипт
- `public/admin.html` - админ-панель
- `public/bookmarklet.html` - страница с инструкциями по установке букмарклета

## Требования

- Node.js 14+
- Современный веб-браузер с поддержкой WebSocket

## Функциональность

### Клиентский скрипт
- Сбор данных со страницы (URL, заголовок, текст, HTML)
- Эмуляция jQuery для страниц без него
- Автоматическое переподключение при обрыве связи
- Отправка данных на сервер с настраиваемым интервалом
- Отображение сообщений от админа с настраиваемой прозрачностью

### Серверная часть
- Управление подключениями клиентов и админов
- Обработка запросов и команд
- Хранение списков активных клиентов
- Передача данных между клиентами и админ-панелью

### Админ-панель
- Современный интерфейс в стиле HuggingFace
- Статистика клиентов
- Просмотр данных с клиентских страниц
- Управление клиентами
- Настройка параметров системы

## Безопасность

- Система работает только с локальными подключениями
- Нет встроенной аутентификации (предполагается использование в доверенной среде)
- Рекомендуется использовать HTTPS в продакшене

## Лицензия

MIT 